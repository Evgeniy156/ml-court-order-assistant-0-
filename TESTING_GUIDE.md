# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –î–ó‚Ññ5: RabbitMQ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
2. [–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã](#–∑–∞–ø—É—Å–∫-—Å–∏—Å—Ç–µ–º—ã)
3. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ REST API](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-—á–µ—Ä–µ–∑-rest-api)
4. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-—á–µ—Ä–µ–∑-telegram-bot)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤–æ—Ä–∫–µ—Ä–æ–≤](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã-–≤–æ—Ä–∫–µ—Ä–æ–≤)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RabbitMQ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-rabbitmq)

---

## üõ† –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd ml-court-order-assistant-0-

# 2. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
cp app/.env.example .env

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:
- `app` - FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `ml-worker-1`, `ml-worker-2`, `ml-worker-3` - ML –≤–æ—Ä–∫–µ—Ä—ã
- `rabbitmq` - RabbitMQ —Å–µ—Ä–≤–µ—Ä
- `database` - PostgreSQL
- `web-proxy` - Nginx

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd app
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ RabbitMQ (—á–µ—Ä–µ–∑ Docker)
docker run -d --name rabbitmq \
  -p 5672:5672 -p 15672:15672 \
  rabbitmq:3-management

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export DATABASE_URL="sqlite:///./dev.db"
export RABBITMQ_HOST="localhost"
export RABBITMQ_PORT="5672"
export RABBITMQ_USER="guest"
export RABBITMQ_PASSWORD="guest"
export SECRET_KEY="your-secret-key"

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ FastAPI
cd app
uvicorn src.main:app --host 0.0.0.0 --port 8000 &

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä—ã (–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö)
WORKER_ID=worker-1 python -m src.ml_worker &
WORKER_ID=worker-2 python -m src.ml_worker &
WORKER_ID=worker-3 python -m src.ml_worker &
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# API –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å
curl http://localhost:8000/health
# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: {"status":"healthy"}

# RabbitMQ UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:15672
# –õ–æ–≥–∏–Ω: guest, –ü–∞—Ä–æ–ª—å: guest
```

---

## üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ REST API

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python test_api_manual.py
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
3. ‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
4. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫—É –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
6. ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

#### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```bash
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`.

#### 3. –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

```bash
curl -X POST http://localhost:8000/balance/deposit \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"amount": 100}'
```

#### 4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ

```bash
curl -X POST http://localhost:8000/predict \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "total_debt": 75000,
    "penalty_amount": 7500,
    "days_overdue": 150,
    "payments_ratio": 0.2,
    "is_physical_person": true
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "task_id": 1,
  "status": "pending",
  "model_name": "court_order_suitability_v1",
  "credits_charged": 5,
  "message": "–ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É..."
}
```

#### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏

```bash
# –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –ø–æ–∫–∞ —Å—Ç–∞—Ç—É—Å –Ω–µ —Å—Ç–∞–Ω–µ—Ç "completed"
curl http://localhost:8000/task/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `pending` - –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏
- `processing` - –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É
- `completed` - –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- `failed` - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

#### 6. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

```bash
curl http://localhost:8000/predictions \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs

–¢–∞–º –º–æ–∂–Ω–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

---

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –≤ Telegram
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export TELEGRAM_BOT_TOKEN="your-bot-token"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python -m app.src.telegram_bot
```

### 2. –°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ Telegram –ø–æ –∏–º–µ–Ω–∏
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –í—ã–±–µ—Ä–∏—Ç–µ "üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
4. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å
5. –í—ã–±–µ—Ä–∏—Ç–µ "‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å"
6. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100 –∫—Ä–µ–¥–∏—Ç–æ–≤)
7. –í—ã–±–µ—Ä–∏—Ç–µ "üîÆ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ"
8. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è:
   - –°—É–º–º–∞ –¥–æ–ª–≥–∞: `75000`
   - –°—É–º–º–∞ –ø–µ–Ω–∏: `7500`
   - –î–Ω–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏: `150`
   - –î–æ–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω–æ–≥–æ: `0.2`
   - –§–∏–∑–ª–∏—Ü–æ: `–î–∞`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `task_id` –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–º, —á—Ç–æ –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å.

> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ –Ω–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ –∏–∑ Telegram. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç `/task/{task_id}` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## üë∑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤–æ—Ä–∫–µ—Ä–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤–æ—Ä–∫–µ—Ä–æ–≤

**Docker:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose logs ml-worker-1 ml-worker-2 ml-worker-3

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f ml-worker-1
```

**–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:**
–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –≤–æ—Ä–∫–µ—Ä.

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö

–£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏:
```
[worker-1] –ü–æ–ª—É—á–µ–Ω–∞ –∑–∞–¥–∞—á–∞ 1 –∏–∑ –æ—á–µ—Ä–µ–¥–∏
[worker-1] –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ 1
[worker-1] –ó–∞–¥–∞—á–∞ 1: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è...
[worker-1] –ó–∞–¥–∞—á–∞ 1: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è = 0.6500
[worker-1] –ó–∞–¥–∞—á–∞ 1 —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
[worker-1] –ó–∞–¥–∞—á–∞ 1 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (ack)
```

### –¢–µ—Å—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –ø–æ–¥—Ä—è–¥:

```bash
for i in {1..10}; do
  curl -X POST http://localhost:8000/predict \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -H "Content-Type: application/json" \
    -d '{
      "total_debt": 50000,
      "penalty_amount": 5000,
      "days_overdue": 100,
      "payments_ratio": 0.3,
      "is_physical_person": true
    }'
  echo ""
done
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ó–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- –í –ª–æ–≥–∞—Ö RabbitMQ (Management UI) –≤—ã —É–≤–∏–¥–∏—Ç–µ —á—Ç–æ –≤—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞—á–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RabbitMQ

### RabbitMQ Management UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:15672
2. –í–æ–π–¥–∏—Ç–µ (guest/guest)

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

#### 1. –û—á–µ—Ä–µ–¥—å `ml_tasks`

**Queues** ‚Üí `ml_tasks`

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **Ready**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –æ–∂–∏–¥–∞—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Unacked**: –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Total**: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
- **Consumers**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 3)

#### 2. Connections

**Connections**

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- 1 –æ—Ç FastAPI (publisher)
- 3 –æ—Ç ML workers (consumers)

#### 3. –ö–∞–Ω–∞–ª—ã

**Channels**

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **Prefetch count** –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å = 1
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á

#### 4. –ì—Ä–∞—Ñ–∏–∫–∏

**Overview** ‚Üí **Message rates**

–ù–∞–±–ª—é–¥–∞–π—Ç–µ:
- **Publish rate**: —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–¥–∞—á
- **Deliver rate**: —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–¥–∞—á–∞–º –≤–æ—Ä–∫–µ—Ä–∞–º
- **Ack rate**: —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|-------------------|---------|
| Consumers = 0 | –í–æ—Ä–∫–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã | –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python -m app.src.ml_worker` |
| Ready —Ä–∞—Å—Ç–µ—Ç | –í–æ—Ä–∫–µ—Ä—ã –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω—ã | –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ |
| Unacked —Ä–∞—Å—Ç–µ—Ç | –í–æ—Ä–∫–µ—Ä –∑–∞–≤–∏—Å | –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä—ã |
| –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π | –ó–∞–¥–∞—á–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FastAPI –ª–æ–≥–∏ |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã (docker-compose ps)
- [ ] API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /health
- [ ] RabbitMQ UI –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] 3 –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ—á–µ—Ä–µ–¥–∏
- [ ] –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- [ ] –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å (–ø–æ–ª—É—á–µ–Ω task_id)
- [ ] –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–æ–º (—Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è)
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- [ ] –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á
- [ ] –ó–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –í–æ—Ä–∫–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker-compose ps` –∏–ª–∏ `ps aux | grep ml_worker`
2. –í–æ—Ä–∫–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ RabbitMQ: Management UI ‚Üí Connections
3. –û—á–µ—Ä–µ–¥—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: Management UI ‚Üí Queues ‚Üí ml_tasks
4. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. RabbitMQ –∑–∞–ø—É—â–µ–Ω: `docker ps | grep rabbitmq`
2. –ü–æ—Ä—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: `telnet localhost 5672`
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ:
   - RABBITMQ_HOST=rabbitmq (–≤ Docker) –∏–ª–∏ localhost
   - RABBITMQ_PORT=5672
   - RABBITMQ_USER=guest
   - RABBITMQ_PASSWORD=guest

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã
cd app
python -c "from storage.db import Base, engine; Base.metadata.create_all(bind=engine)"
```

---

## üìù –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –æ—Ç—á–µ—Ç —Å:

1. ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç—ã RabbitMQ UI:
   - Queues —Å 3 consumers
   - Message rates –≥—Ä–∞—Ñ–∏–∫–∏
   - Connections —Å–ø–∏—Å–æ–∫

2. ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ API:
   - POST /predict ‚Üí task_id
   - GET /task/{id} ‚Üí completed

3. ‚úÖ –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤:
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Ä–∞–∑–Ω—ã–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
   - –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á

4. ‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç Telegram –±–æ—Ç–∞ (–µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏)

---

**üéâ –£—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!**
